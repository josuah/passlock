#!/usr/bin/awk -f

/^[a-zA-Z0-9_]+\(/ {
	symbol = $0;
	sub("\\(.*", "", symbol);

	lib = symbol
	sub("_.*", "", lib)

	system("mkdir -p 'lib" lib "'")

	path = "lib" lib "/" symbol ".c"

	print path

	print "#include \"" lib ".h\"" > path
	print ""                       >> path
	print type                     >> path

	IN = 1;
}

IN {
	print                           >> path
}

!IN {
	type = $0;
}

IN && /^\}$/ {
	IN = 0
}

